<% content_for :page_title, "All Entries Timeline" %>
<div>

  <% if @all_entries.any? %>
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
      <thead>
        <tr>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Type</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Description / Symptom</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Date/Time</th>
        </tr>
      </thead>
      <tbody>
        <% @all_entries.each do |item| %>
          <% 
            # Determine background color and edit path
            if item[:type] == 'food'
              bg_color = '#E8F5E9'
              edit_path = edit_food_entry_path(item[:entry], return_to: request.url)
            elsif item[:type] == 'bowel_movement'
              bg_color = '#F3E5F5'
              edit_path = edit_bowel_movement_path(item[:entry], return_to: request.url)
            elsif item[:type] == 'accident'
              bg_color = '#FFF3E0'
              edit_path = edit_accident_path(item[:entry], return_to: request.url)
            elsif item[:type] == 'miralax_cap'
              bg_color = '#E1F5FE'
              edit_path = edit_miralax_cap_path(item[:entry], return_to: request.url)
            end
            
            # Format date/time
            formatted_date = item[:datetime].strftime("%b %d, %Y at %l:%M %p").strip
          %>
          <tr onclick="window.location.href='<%= edit_path %>'" style="cursor: pointer;">
            <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
              <% if item[:type] == 'food' %>
                <span style="background-color: #4CAF50; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">FOOD</span>
              <% elsif item[:type] == 'bowel_movement' %>
                <span style="background-color: #9C27B0; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">BM</span>
              <% elsif item[:type] == 'accident' %>
                <span style="background-color: #FF9800; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ACCIDENT</span>
              <% elsif item[:type] == 'miralax_cap' %>
                <span style="background-color: #00BCD4; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">MIRALAX</span>
              <% end %>
            </td>
            <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
              <% if item[:type] == 'food' %>
                <%= item[:entry].description %>
              <% elsif item[:type] == 'bowel_movement' %>
                <% if item[:entry].severity.present? %>
                  <%= item[:entry].severity %> - <%= item[:entry].severity_term %>
                <% else %>
                  -
                <% end %>
              <% elsif item[:type] == 'accident' %>
                <%= item[:entry].accident_type_label || '-' %>
              <% elsif item[:type] == 'miralax_cap' %>
                <%= item[:entry].amount_label || '-' %>
              <% end %>
            </td>
            <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
              <%= formatted_date %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p style="margin-top: 20px; color: #000;">
      No entries yet. 
      <%= link_to "Create your first food entry", new_food_entry_path %>, 
      <%= link_to "add a bowel movement", new_bowel_movement_path %>, 
      <%= link_to "add an accident", new_accident_path %>, or 
      <%= link_to "add a miralax cap", new_miralax_cap_path %>.
    </p>
  <% end %>
</div>

