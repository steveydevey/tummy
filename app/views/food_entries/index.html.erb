<% content_for :page_title, @show_all_entries ? "Food & Poop & Accident Tracker" : "Food Entries" %>
<div>

  <% if @show_all_entries %>
    <%# Unified timeline view for root path with date filtering %>
    <% 
      prev_date = @selected_date - 1.day
      next_date = @selected_date + 1.day
      today = Time.zone.today
      is_today = @selected_date == today
    %>
    
    <% if @all_entries.any? %>
      <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
          <tr>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Type</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Description / Symptom</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Date/Time</th>
          </tr>
        </thead>
        <tbody>
          <% @all_entries.each do |item| %>
            <% 
              # Determine background color and edit path
              if item[:type] == 'food'
                bg_color = '#E8F5E9'
                edit_path = edit_food_entry_path(item[:entry], return_to: request.url)
              elsif item[:type] == 'bowel_movement'
                bg_color = '#F3E5F5'
                edit_path = edit_bowel_movement_path(item[:entry], return_to: request.url)
              elsif item[:type] == 'accident'
                bg_color = '#FFF3E0'
                edit_path = edit_accident_path(item[:entry], return_to: request.url)
              end
              
              # Format date/time
              formatted_date = item[:datetime].strftime("%b %d, %Y at %l:%M %p").strip
            %>
            <tr onclick="window.location.href='<%= edit_path %>'" style="cursor: pointer;">
              <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
                <% if item[:type] == 'food' %>
                  <span style="background-color: #4CAF50; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">FOOD</span>
                <% elsif item[:type] == 'bowel_movement' %>
                  <span style="background-color: #9C27B0; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">BM</span>
                <% elsif item[:type] == 'accident' %>
                  <span style="background-color: #FF9800; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">ACCIDENT</span>
                <% end %>
              </td>
              <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
                <% if item[:type] == 'food' %>
                  <%= item[:entry].description %>
                <% elsif item[:type] == 'bowel_movement' %>
                  <% if item[:entry].severity.present? %>
                    <%= item[:entry].severity %> - <%= item[:entry].severity_term %>
                  <% else %>
                    -
                  <% end %>
                <% elsif item[:type] == 'accident' %>
                  <%= item[:entry].accident_type_label || '-' %>
                <% end %>
              </td>
              <td style="padding: 12px; border: 1px solid #ddd; background-color: <%= bg_color %>; color: #000;">
                <%= formatted_date %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p style="margin-top: 20px; color: #000;">
        No entries for <%= @selected_date.strftime("%B %d, %Y") %>. 
        <%= link_to "Create your first food entry", new_food_entry_path(date: @selected_date, return_to: request.url) %>, 
        <%= link_to "add a bowel movement", new_bowel_movement_path(date: @selected_date, return_to: request.url) %>, or 
        <%= link_to "add an accident", new_accident_path(date: @selected_date, return_to: request.url) %>.
      </p>
    <% end %>
    
    <%# Date navigation - moved to bottom for daily view %>
    <div style="margin-top: 30px; padding: 15px; background-color: #f5f5f5; border-radius: 4px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <%= link_to root_path(date: prev_date), style: "background-color: #2196F3; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; white-space: nowrap;" do %>
          ← Previous Day
        <% end %>
        <div style="font-size: 18px; font-weight: bold; color: #000; min-width: 200px; text-align: center;">
          <%= @selected_date.strftime("%B %d, %Y") %>
          <% if is_today %>
            <span style="font-size: 12px; color: #666; font-weight: normal;">(Today)</span>
          <% end %>
        </div>
        <%= link_to root_path(date: next_date), style: "background-color: #2196F3; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; white-space: nowrap;" do %>
          Next Day →
        <% end %>
      </div>
      <div>
        <% if !is_today %>
          <%= link_to "Go to Today", root_path, style: "background-color: #4CAF50; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; white-space: nowrap;" %>
        <% end %>
      </div>
    </div>
  <% else %>
    <%# Food entries only view for /food_entries path %>
    <% if @food_entries.any? %>
      <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
          <tr>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Description</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd; background-color: #f2f2f2; color: #000;">Consumed At</th>
          </tr>
        </thead>
        <tbody>
          <% @food_entries.each do |food_entry| %>
            <% 
              edit_path = edit_food_entry_path(food_entry, return_to: request.url)
              formatted_date = food_entry.consumed_at.strftime("%b %d, %Y at %l:%M %p").strip
            %>
            <tr onclick="window.location.href='<%= edit_path %>'" style="cursor: pointer;">
              <td style="padding: 12px; border: 1px solid #ddd; background-color: #E8F5E9; color: #000;"><%= food_entry.description %></td>
              <td style="padding: 12px; border: 1px solid #ddd; background-color: #E8F5E9; color: #000;"><%= formatted_date %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p style="margin-top: 20px; color: #000;">No food entries yet. <%= link_to "Create your first entry", new_food_entry_path(return_to: request.url) %>.</p>
    <% end %>
  <% end %>
</div>
